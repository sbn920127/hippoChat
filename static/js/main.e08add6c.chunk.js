(this.webpackJsonptalk=this.webpackJsonptalk||[]).push([[0],[,,,,,,,,,,,,,,,function(e,t,a){e.exports={"chat-space-header":"ChatSpace_chat-space-header__2KspR","user-name":"ChatSpace_user-name__IXPIh",dialogue:"ChatSpace_dialogue__200KM",dialog:"ChatSpace_dialog__Y1UlP",avatar:"ChatSpace_avatar__1yLxO",say:"ChatSpace_say__3Z6ln",states:"ChatSpace_states__1yjFX",remote:"ChatSpace_remote__3W4AV",local:"ChatSpace_local__etFqx","chat-input":"ChatSpace_chat-input__qy9e_","chat-input-field":"ChatSpace_chat-input-field__1Y3dG","chat-input-tool":"ChatSpace_chat-input-tool__251Xc","icon-btn":"ChatSpace_icon-btn__lL0fl","icon-btn-submit":"ChatSpace_icon-btn-submit__17JiR ChatSpace_icon-btn__lL0fl","icon-btn-emoji":"ChatSpace_icon-btn-emoji__1Gvyb ChatSpace_icon-btn__lL0fl"}},,,,function(e,t,a){e.exports={header:"Header_header__MbTxY",fixed:"Header_fixed__1bXSb",nav:"Header_nav__1qWb_",navbar:"Header_navbar__2AxSS","navbar-brand":"Header_navbar-brand__1iGbD","nav-link":"Header_nav-link__3l94V","burger-menu":"Header_burger-menu__LVpEC","nav-active":"Header_nav-active__1GPcU Header_nav__1qWb_","nav-item":"Header_nav-item__pKk_k"}},,,,,,function(e,t,a){e.exports={row:"chatList_row__3bObz",items:"chatList_items__3zMAM",item:"chatList_item__1rPCt","item-active":"chatList_item-active__2o27v chatList_item__1rPCt",summary:"chatList_summary__2ovCu","summary-avatar":"chatList_summary-avatar__1ZWJk","summary-content":"chatList_summary-content__CeFAJ","summary-name":"chatList_summary-name__1panW","summary-text":"chatList_summary-text__tnoDO",col:"chatList_col__1WcEy",date:"chatList_date__2o34K",unread:"chatList_unread__3Z-K-"}},,,,,,,,function(e,t,a){e.exports={"text-field":"TextField_text-field__1iIu4","input-field":"TextField_input-field__dxXZa",label:"TextField_label__uKNDo",input:"TextField_input__2ZaZ2",writing:"TextField_writing__3Hr-C","invalid-feedback":"TextField_invalid-feedback__20671"}},,function(e,t,a){e.exports={card:"CardMember_card__reP1O","card-body":"CardMember_card-body__35bMZ","card-title":"CardMember_card-title__1uNMn","img-frame":"CardMember_img-frame__1y8lU",btn:"CardMember_btn__3JmXv"}},,,,,function(e,t,a){e.exports={"btn-menu":"BtnBurgerMenu_btn-menu__t-cWL","btn-menu-active":"BtnBurgerMenu_btn-menu-active__3i2eE","burger-inner":"BtnBurgerMenu_burger-inner__mXelr","burger-box":"BtnBurgerMenu_burger-box__gcWop","burger-menu":"BtnBurgerMenu_burger-menu__3KtR7"}},,,,,,function(e,t,a){e.exports={avatar:"AvatarUpdate_avatar__2ymA7","avatar-btn":"AvatarUpdate_avatar-btn__2IZBr","img-frame":"AvatarUpdate_img-frame___aoDr"}},,,,,,,,,function(e,t,a){e.exports={logout:"BtnLogout_logout__1V49j"}},function(e,t,a){e.exports={inner:"login_inner__2y96n"}},,,function(e,t,a){e.exports=a.p+"static/media/facebook-f-brands.53757d93.svg"},function(e,t,a){e.exports=a.p+"static/media/google-brands.da3a9ed4.svg"},function(e,t,a){e.exports=a.p+"static/media/github-brands.ec5bc1b3.svg"},function(e,t,a){e.exports={"input-field":"account_input-field__X1-Jj"}},,function(e,t,a){e.exports=a(101)},,,,,function(e,t,a){},,,,,,,,,,,,,,,function(e,t,a){},,function(e,t,a){},,function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},,function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),c=a(54),i=a.n(c),s=a(6),l=a(7),o=a(10),u=a(9),m=a(24),d=a(5),h=(a(69),a(2)),p=a(14),v=a.n(p);p.initializeApp({apiKey:"AIzaSyADu9CWQ78aswvnNtVhxK-W-T9av4g2jt0",authDomain:"hippo-chat-17580.firebaseapp.com",databaseURL:"https://hippo-chat-17580.firebaseio.com",projectId:"hippo-chat-17580",storageBucket:"hippo-chat-17580.appspot.com",messagingSenderId:"285407145365",appId:"1:285407145365:web:97f559eb273b6d11241a9c",measurementId:"G-2WWKLLKNC4"});var f=p.auth(),b=p.firestore(),g=p.storage(),E=r.a.createContext(),_=function(e){Object(o.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(s.a)(this,a),(n=t.call(this,e)).setCurrentChatId=n.setCurrentChatId.bind(Object(h.a)(n)),n.state={currentUser:null,currentChatId:null,padding:!0,changeChatId:n.setCurrentChatId},n}return Object(l.a)(a,[{key:"componentDidMount",value:function(){var e=this;f.onAuthStateChanged((function(t){e.setState({currentUser:t,padding:!1})}))}},{key:"setCurrentChatId",value:function(e){this.setState({currentChatId:e})}},{key:"render",value:function(){return this.state.padding?r.a.createElement(r.a.Fragment,null,"Loading..."):r.a.createElement(E.Provider,{value:this.state},this.props.children)}}]),a}(r.a.Component),C=a(45),k=function(e){var t=e.component,a=Object(C.a)(e,["component"]),c=Object(n.useContext)(E).currentUser;return r.a.createElement(d.b,Object.assign({},a,{render:function(e){return c?r.a.createElement(t,Object.assign({},e,a.props)):r.a.createElement(d.a,{to:"/login"})}}))},y=a(19),j=a.n(y),O=a(40),N=a.n(O),w=function(e){var t=[N.a["btn-menu"]];return e.active&&t.push(N.a["btn-menu-active"]),t=t.join(" "),e.className&&(t+=" "+e.className),r.a.createElement("button",{type:"button",className:t,onClick:e.onClick},r.a.createElement("div",{className:N.a["burger-box"]},r.a.createElement("div",{className:N.a["burger-inner"]})))},x=a(55),S=a.n(x),U=function(e){return r.a.createElement("button",{className:S.a.logout,type:"button","aria-label":"logout",onClick:function(){e.onClick&&e.onClick(),f.signOut(),alert("\u5df2\u767b\u51fa")}},"\u767b\u51fa")},M=function(e){var t=Object(n.useContext)(E),a=t.currentUser,c=t.changeChatId;return a?r.a.createElement(r.a.Fragment,null,r.a.createElement("li",{className:j.a["nav-item"]},r.a.createElement(m.b,{to:"/chat",className:j.a["nav-link"],onClick:function(){c(""),e.onClick()}},"Chat")),r.a.createElement("li",{className:j.a["nav-item"]},r.a.createElement(m.b,{to:"/account",className:j.a["nav-link"],onClick:e.onClick},"\u5e33\u865f")),r.a.createElement("li",{className:j.a["nav-item"]},r.a.createElement(U,{onClick:e.onClick}))):r.a.createElement(r.a.Fragment,null,r.a.createElement("li",{className:j.a["nav-item"]},r.a.createElement(m.b,{to:"/login",className:j.a["nav-link"],onClick:e.onClick},"\u767b\u5165/\u8a3b\u518a")))},L=function(e){Object(o.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(s.a)(this,a),(n=t.call(this,e)).state={menuActive:!1,navClass:j.a.nav},n.handlerClick=n.handlerClick.bind(Object(h.a)(n)),n}return Object(l.a)(a,[{key:"handlerClick",value:function(){console.log("hi"),this.setState((function(e){return{menuActive:!e.menuActive,navClass:e.menuActive?j.a.nav:j.a["nav-active"]}}))}},{key:"render",value:function(){var e=this;return r.a.createElement("header",{className:j.a.header,ref:this.props.headerRef},r.a.createElement("nav",{className:j.a.navbar},r.a.createElement(m.b,{to:"/",className:j.a["navbar-brand"]},"Hippo chat"),r.a.createElement("ul",{className:this.state.navClass},r.a.createElement(M,{onClick:this.handlerClick})),r.a.createElement(w,{className:j.a["burger-menu"],active:this.state.menuActive,onClick:function(){return e.handlerClick()}})))}}]),a}(r.a.Component),H=(a(84),a(56)),I=a.n(H),F=a(3),D=a.n(F),A=a(17),B=a(29),R=(a(86),a(18)),W=function(e){var t;return e?/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}$/i.test(e)||(t="\u7121\u6548\u7684Email\u683c\u5f0f"):t="\u5fc5\u586b",t},P=function(e){var t;return e?e.length<6?t="\u5bc6\u78bc\u592a\u77ed\u56c9":/[A-Z]{1,}/i.test(e)||(t="\u81f3\u5c11\u8981\u4e00\u500b\u5b57\u6bcd"):t="\u5fc5\u586b",t},G=function(e){var t;return e||(t="\u5fc5\u586b"),t},z=a(33),T=a.n(z),K=function(e){var t=e.label,a=Object(C.a)(e,["label"]),n=Object(R.d)(a),c=Object(B.a)(n,2),i=c[0],s=c[1],l=[T.a.input];return s.value&&s.value.length>0&&l.push(T.a.writing),l=l.join(" "),r.a.createElement("div",{className:T.a["text-field"]},r.a.createElement("div",{className:T.a["input-field"]},r.a.createElement(R.a,Object.assign({className:l},i,a)),r.a.createElement("label",{htmlFor:a.name,className:T.a.label},t)),s.touched&&s.error?r.a.createElement("div",{className:T.a["invalid-feedback"]},s.error):null)},Z=(a(88),function(e){return r.a.createElement("button",{type:e.type||"button",className:"main-btn",onChange:e.onChange},r.a.createElement("span",null,e.text))}),V=(a(89),a(59),a(60),a(61),a(90),a(91),function(e){return r.a.createElement("button",{className:"close",type:"button","aria-label":"close",onClick:e.onClick},r.a.createElement("span",{"aria-hidden":"true"},"\xd7"))}),X=function(e){var t=Object(n.useState)(!1),a=Object(B.a)(t,2),c=a[0],i=a[1];return c?null:r.a.createElement("div",{className:"alert ".concat(e.className),role:"alert"},e.hasCloseBtn&&r.a.createElement(V,{onClick:function(){return i(!0)}}),e.children)},J=function(e){var t=Object(d.g)(),a=Object(n.useState)(null),c=Object(B.a)(a,2),i=c[0],s=c[1];return r.a.createElement("div",{className:"login"},r.a.createElement("h1",null,"\u767b\u5165\u5e33\u865f"),r.a.createElement(R.c,{initialValues:{email:"",password:""},onSubmit:function(){var e=Object(A.a)(D.a.mark((function e(a,n){var r,c,i;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.resetForm,c=a.email,i=a.password,e.prev=2,e.next=5,f.signInWithEmailAndPassword(c,i);case 5:t.push("/"),e.next=12;break;case 8:e.prev=8,e.t0=e.catch(2),s(e.t0.code),r({email:"",password:""});case 12:case"end":return e.stop()}}),e,null,[[2,8]])})));return function(t,a){return e.apply(this,arguments)}}()},r.a.createElement(r.a.Fragment,null,i&&function(e){switch(e){case"auth/wrong-password":return r.a.createElement(X,{className:"alert-danger"},"\u5bc6\u78bc\u932f\u8aa4");case"auth/user-not-found":return r.a.createElement(X,{className:"alert-danger"},"\u6b64\u5e33\u865f\u4e0d\u5b58\u5728");default:return null}}(i),r.a.createElement(R.b,null,r.a.createElement(K,{label:"Email",name:"email",type:"email",validate:W}),r.a.createElement(K,{label:"\u5bc6\u78bc",name:"password",type:"password",validate:G}),r.a.createElement("p",null,r.a.createElement("button",{type:"button",className:"link",onClick:e.onClickForgetForm},"\u5fd8\u8a18\u5bc6\u78bc\uff1f")),r.a.createElement(Z,{text:"\u767b\u5165",type:"submit"})))))},q=(a(92),function(e){return r.a.createElement("div",{className:"register"},r.a.createElement("h1",null,"\u8a3b\u518a\u5e33\u865f"),r.a.createElement(R.c,{initialValues:{nickname:"",email:"",password:"",confirmPassword:""},onSubmit:function(){var t=Object(A.a)(D.a.mark((function t(a,n){var r,c,i,s;return D.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=n.resetForm,c=a.email,i=a.password,s=a.nickname,t.prev=2,t.next=5,f.createUserWithEmailAndPassword(c,i).then((function(t){e.handleResponse("success"),g.ref("avatars/default.jpg").getDownloadURL().then((function(e){b.collection("users").doc(t.user.uid).set({nickname:s,avatar:{fileLocation:"avatars/default.jpg",url:e}})})),r({nickname:"",email:"",password:""})}));case 5:t.next=11;break;case 7:t.prev=7,t.t0=t.catch(2),e.handleResponse(t.t0.code),r({nickname:"",email:"",password:""});case 11:case"end":return t.stop()}}),t,null,[[2,7]])})));return function(e,a){return t.apply(this,arguments)}}()},(function(e){var t=e.values;return r.a.createElement(R.b,null,r.a.createElement(K,{label:"\u66b1\u7a31/\u7a31\u547c",name:"nickname",type:"text",validate:G}),r.a.createElement(K,{label:"Email",name:"email",type:"email",validate:W}),r.a.createElement(K,{label:"\u5bc6\u78bc",name:"password",type:"password",validate:P}),r.a.createElement(K,{label:"\u78ba\u8a8d\u5bc6\u78bc",name:"confirmPassword",type:"password",validate:function(e){return function(e,t){var a;return e?e!==t&&(a="\u5bc6\u78bc\u4e0d\u76f8\u7b26"):a="\u5fc5\u586b",a}(e,t.password)}}),r.a.createElement(Z,{text:"\u8a3b\u518a",type:"submit"}))})))}),Y=(a(93),a(94),function(e){var t=e.className?e.className:"";return e.title.length?r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"modal modal-format ".concat(t)},r.a.createElement("div",{className:"modal-inner"},r.a.createElement(V,{onClick:e.onClick}),r.a.createElement("div",{className:"modal-header"},r.a.createElement("h1",null,e.title)),r.a.createElement("div",{className:"modal-content"},e.children))),r.a.createElement("div",{className:"modal-overlay"})):r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"modal ".concat(t)},r.a.createElement("div",{className:"modal-inner"},r.a.createElement(V,{onClick:e.onclick}),r.a.createElement("div",{className:"modal-content"},e.children))),r.a.createElement("div",{className:"modal-overlay"}))}),$=function(e){var t=Object(n.useState)(null),a=Object(B.a)(t,2),c=a[0],i=a[1];return r.a.createElement(Y,{className:"forget-password",title:"\u5fd8\u8a18\u5bc6\u78bc\uff1f",onClick:e.onClick},r.a.createElement("p",null,"\u8acb\u8f38\u5165\u7576\u521d\u8a3b\u518a\u7684Email\uff0c\u6211\u5011\u5c07\u6703\u5bc4\u4e00\u5c01\u91cd\u8a2d\u5bc6\u78bc\u4fe1\u7d66\u60a8"),r.a.createElement(R.c,{initialValues:{email:""},onSubmit:function(){var e=Object(A.a)(D.a.mark((function e(t,a){var n;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.resetForm,e.prev=1,e.next=4,f.sendPasswordResetEmail(t.email).then((function(){i("success"),n({email:"",password:""})}));case 4:e.next=10;break;case 6:e.prev=6,e.t0=e.catch(1),i(e.t0.code),n({email:"",password:""});case 10:case"end":return e.stop()}}),e,null,[[1,6]])})));return function(t,a){return e.apply(this,arguments)}}()},r.a.createElement(R.b,null,c&&function(e){switch(e){case"success":return r.a.createElement(X,{className:"alert-success"},"\u5df2\u767c\u9001\u5230\u4f60\u7684Email");case"auth/user-not-found":return r.a.createElement(X,{className:"alert-danger"},"\u6c92\u6709\u7b26\u5408\u7684\u8a3b\u518aEmail\u8cc7\u8a0a");default:return null}}(c),r.a.createElement(K,{label:"Email",name:"email",type:"email",validate:W}),r.a.createElement(Z,{type:"submit",text:"\u9001\u51fa"}))))},Q=function(e){switch(e.code){case"success":return r.a.createElement(Y,{title:"\u6b61\u8fce\u60a8\u5df2\u6210\u70ba Hippo",onClick:e.onClick},r.a.createElement("p",null,"\u6211\u5011\u5df2\u5bc4\u8a3b\u518a\u9a57\u8b49\u4fe1\u5230\u4f60\u7684Email\uff0c\u8acb\u60a8\u7e7c\u7e8c\u5b8c\u6210\u9a57\u8b49\u3002"),r.a.createElement(m.b,{to:"/",className:"btn btn-rounded btn-primary"},"\u56de\u9996\u9801"));case"auth/email-already-in-use":return r.a.createElement(Y,{title:"\u8a3b\u518a\u5931\u6557",onClick:e.onClick},r.a.createElement("p",null,"\u9019\u500bEmail\u5df2\u7d93\u662f\u7db2\u7ad9\u6703\u54e1\uff0c\u6c92\u6709\u8fa6\u6cd5\u91cd\u8907\u8a3b\u518a\u5594\u3002"));default:return null}},ee=function(e){Object(o.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(s.a)(this,a),(n=t.call(this,e)).state={active:"activeA",hide:"groupB",responseStatus:null,isModalOpen:!1,forgetPasswordStatus:!1},n.handleClick=n.handleClick.bind(Object(h.a)(n)),n.showForgetPassword=n.showForgetPassword.bind(Object(h.a)(n)),n.handleResponseStatus=n.handleResponseStatus.bind(Object(h.a)(n)),n.hideModal=n.hideModal.bind(Object(h.a)(n)),n}return Object(l.a)(a,[{key:"handleClick",value:function(){var e=this;this.setState((function(e){return{active:"activeA"===e.active?"activeB":"activeA"}})),setTimeout((function(){return e.setState((function(e){return{hide:"groupB"===e.hide?"groupA":"groupB"}}))}),400)}},{key:"showForgetPassword",value:function(){this.setState((function(e){return{forgetPasswordStatus:!e.forgetPasswordStatus}}))}},{key:"handleResponseStatus",value:function(e){this.setState((function(t){return{responseStatus:e,isModalOpen:!0}}))}},{key:"hideModal",value:function(){this.setState((function(e){return{isModalOpen:!1}}))}},{key:"render",value:function(){var e=this,t="".concat(I.a.inner," ").concat(this.state.active),a="groupA"===this.state.hide?"hide":"",n="groupB"===this.state.hide?"hide":"";return r.a.createElement("main",{className:"container-fluid"},r.a.createElement("div",{className:t},r.a.createElement("div",{className:"form groupA ".concat(a)},r.a.createElement(J,{onClickForgetForm:this.showForgetPassword})),r.a.createElement("div",{className:"box groupA ".concat(a)},r.a.createElement("div",{className:"box-inner"},r.a.createElement("h2",{className:"text-white"},"\u4f60\u662f\u65b0\u6210\u54e1\uff1f"),r.a.createElement("button",{type:"button",className:"btn btn-rounded btn-white-outline",onClick:function(){return e.handleClick()}},"\u524d\u5f80\u8a3b\u518a"))),r.a.createElement("div",{className:"form groupB ".concat(n)},r.a.createElement(q,{handleResponse:this.handleResponseStatus})),r.a.createElement("div",{className:"box groupB ".concat(n)},r.a.createElement("div",{className:"box-inner"},r.a.createElement("h2",{className:"text-white"},"\u4f60\u5df2\u7d93\u6709\u5e33\u865f\u4e86\u55ce\uff1f"),r.a.createElement("button",{type:"button",className:"btn btn-rounded btn-white-outline",onClick:function(){return e.handleClick()}},"\u524d\u5f80\u767b\u5165")))),this.state.forgetPasswordStatus&&r.a.createElement($,{onClick:this.showForgetPassword}),this.state.isModalOpen&&r.a.createElement(Q,{code:this.state.responseStatus,onClick:this.hideModal}))}}]),a}(r.a.Component),te=a(26),ae=a(63),ne=a(11),re=(a(95),a(96),a(25)),ce=a.n(re),ie=a(34),se=a.n(ie);var le=function(e){var t=Object(n.useContext)(E),a=t.currentUser,c=t.currentChatId,i=e.chat,s=function(e){var t,a=se()(),n=se()(+e),r=a.diff(n,"seconds"),c=a.diff(n,"minutes"),i=a.diff(n,"hours");return a.get("date")===n.get("date")?0===r||1===r?t="1\u79d2\u524d":r<=60?t="".concat(r,"\u79d2\u524d"):c<=60?t="".concat(c,"\u5206\u9418\u524d"):i<=24&&(t=n.format("H:mm")):t=i<=48?"\u6628\u5929":i<=72?"\u524d\u5929":n.format("MM/DD"),t}(i.last_msg_id),l=c===i.id?ce.a["item-active"]:ce.a.item,o=a.uid;return r.a.createElement("li",{className:l,onClick:function(){e.onClick(i.id)}},r.a.createElement("div",{className:ce.a.summary},r.a.createElement("div",{className:ce.a["summary-avatar"]},r.a.createElement("img",{src:i.avatar,alt:""})),r.a.createElement("h4",{className:ce.a["summary-name"]},i.name,i.members.length>2?r.a.createElement("span",null,"(".concat(i.members.length,")")):null),r.a.createElement("p",{className:ce.a["summary-text"]},i.last_msg),r.a.createElement("div",{className:ce.a.col},r.a.createElement("div",{className:ce.a.date},s),i.unread[o]>0?r.a.createElement("span",{className:ce.a.unread},i.unread[o]):null)))},oe=function(e){Object(o.a)(a,e);var t=Object(u.a)(a);function a(e){var r;return Object(s.a)(this,a),(r=t.call(this,e)).state={searchHeight:"auto",roomHeight:0,padding:!1,search:"",chats:[]},r.search=Object(n.createRef)(),r.UpdateDimensions=r.UpdateDimensions.bind(Object(h.a)(r)),r.FilterChat=r.FilterChat.bind(Object(h.a)(r)),r}return Object(l.a)(a,[{key:"componentDidMount",value:function(){this.FilterChat(),window.addEventListener("resize",this.UpdateDimensions)}},{key:"shouldComponentUpdate",value:function(e,t){return this.props.headerHeight!==e.headerHeight&&this.UpdateDimensions(),!0}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.UpdateDimensions)}},{key:"UpdateDimensions",value:function(){this.setState({searchHeight:this.search.current.clientHeight},(function(){var e=this;this.setState((function(t){return{roomHeight:window.innerHeight-(e.props.headerHeight+t.searchHeight)}}))}))}},{key:"FilterChat",value:function(){var e=this.props.chats,t=RegExp(this.state.search,"gi"),a=e.filter((function(e){var a=e.name;return t.test(a)}));this.setState({chats:a})}},{key:"render",value:function(){var e=this,t=this.state.chats.map((function(t){return r.a.createElement(le,{key:t.id,chat:t,onClick:e.props.talking})}));return r.a.createElement("section",{className:"chat-control ".concat(this.props.className)},r.a.createElement("div",{className:"chat-search",ref:this.search},r.a.createElement("div",{className:"input-field"},r.a.createElement("label",{htmlFor:"roomSearch"},"\u641c\u5c0b",r.a.createElement("i",{className:"fa fa-search"})),r.a.createElement("input",{id:"roomSearch",type:"text",onChange:function(t){e.setState({search:t.target.value},(function(){this.FilterChat()}))},value:this.state.search})),r.a.createElement("button",{className:"icon-btn",title:"\u6392\u5e8f"},r.a.createElement("i",{className:"fa fa-sort"}))),r.a.createElement("ul",{className:ce.a.items,style:{height:this.state.roomHeight}},t.length>0?t:r.a.createElement("p",{className:"text-center pt-5"},"\u627e\u500b\u4eba\u804a\u5929\u5427\uff01")))}}]),a}(r.a.Component);oe.contextType=E;var ue=oe,me=a(15),de=a.n(me);function he(e){var t=e.clientHeight,a=e.scrollHeight,n=t<150?a:t;return n>150&&(n=150),n}var pe=function(e){var t=Object(n.useContext)(E).currentUser.uid,a=de.a.dialog,c=e.msg,i=e.members.filter((function(e){return e.id===c.sentBy}))[0];return c.sentBy===t?a+=" "+de.a.local:a+=" "+de.a.remote,r.a.createElement("div",{className:a},c.sentBy!==t&&r.a.createElement("div",{className:de.a.avatar},r.a.createElement("img",{src:i.avatar.url,alt:i.nickname})),r.a.createElement("div",{className:de.a.say},c.text),r.a.createElement("div",{className:de.a.states},c.sentBy===t&&r.a.createElement("div",null,c.readed?"\u5df2\u8b80":""),r.a.createElement("div",null,function(e){var t,a=se()(),n=se()(+e),r=a.diff(n,"seconds"),c=a.diff(n,"minutes"),i=a.diff(n,"hours");return a.get("date")===n.get("date")?0===r||1===r?t="1\u79d2\u524d":r<=60?t="".concat(r,"\u79d2\u524d"):c<=60?t="".concat(c,"\u5206\u9418\u524d"):i<=24&&(t=n.format("H:mm")):t=i<=48?"\u6628\u5929":i<=72?"\u524d\u5929":n.format("MM/DD"),t}(c.id))))},ve=function(e){Object(o.a)(a,e);var t=Object(u.a)(a);function a(e){var r;return Object(s.a)(this,a),(r=t.call(this,e))._header=Object(n.createRef)(),r._chatInputSection=Object(n.createRef)(),r.state={headerHeight:"auto",inputHeight:"auto",dialogueHeight:"auto",value:"",showing:!1},r.UpdateDimensions=r.UpdateDimensions.bind(Object(h.a)(r)),r.inputHandle=r.inputHandle.bind(Object(h.a)(r)),r.submitHandle=r.submitHandle.bind(Object(h.a)(r)),r}return Object(l.a)(a,[{key:"componentDidMount",value:function(){window.addEventListener("resize",this.UpdateDimensions)}},{key:"shouldComponentUpdate",value:function(e,t){return"auto"==t.dialogueHeight&&Object.keys(e.current.chat).length>0&&this._header.current&&this.UpdateDimensions(),!0}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.UpdateDimensions)}},{key:"UpdateDimensions",value:function(){this.setState({headerHeight:this._header.current.clientHeight},(function(){var e=this;this.setState((function(t){return{dialogueHeight:window.innerHeight-(e.props.headerHeight+e._chatInputSection.current.clientHeight+t.headerHeight+2)}}))}))}},{key:"inputHandle",value:function(e){var t=e.target;this.setState({value:t.value}),this.setState({inputHeight:"auto"},(function(){this.setState({inputHeight:he(t)}),this.UpdateDimensions()}))}},{key:"submitHandle",value:function(e){var t=this.context.currentUser;if(13===e.nativeEvent.keyCode||"click"===e.nativeEvent.type){e.preventDefault();var a=this.state.value;"string"===typeof a&&(a=a.trim()).length>0&&(this.props.AddMessages({text:a,sentBy:t.uid}),this.setState({value:""}))}}},{key:"render",value:function(){var e=this.props.className?"chat-space "+this.props.className:"chat-space",t=this.props.current,a=t.chat,n=t.members,c=t.dialogue,i=[];return n.length>0&&(i=c.map((function(e){return r.a.createElement(pe,{key:e.id,msg:e,members:n})}))),0==Object.keys(a).length?r.a.createElement("section",{className:e}):r.a.createElement("section",{className:e},r.a.createElement("header",{ref:this._header,className:de.a["chat-space-header"]},r.a.createElement("button",{className:de.a["icon-btn"],onClick:this.props.toList},r.a.createElement("i",{className:"fa fa-chevron-left"})),r.a.createElement("h4",{className:de.a["user-name"]},Object.keys(this.props.current.chat).length>0?this.props.current.chat.name:"...")),r.a.createElement("div",{className:de.a["chat-space-body"]},r.a.createElement("div",{className:de.a.dialogue,style:{height:this.state.dialogueHeight}},i.length?i:null),r.a.createElement("div",{className:de.a["chat-input"],ref:this._chatInputSection},r.a.createElement("div",{className:de.a["chat-input-field"]},r.a.createElement("textarea",{rows:"1",placeholder:"\u8f38\u5165\u8a0a\u606f",value:this.state.value,onChange:this.inputHandle,onKeyPress:this.submitHandle,style:{height:this.state.inputHeight}})),r.a.createElement("div",{className:de.a["chat-input-tool"]},r.a.createElement("button",{className:de.a["icon-btn-submit"],title:"\u50b3\u9001",onClick:this.submitHandle},r.a.createElement("i",{className:"fa fa-paper-plane"}))))))}}]),a}(r.a.Component);ve.contextType=E;var fe=ve,be=function(e){Object(o.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(s.a)(this,a),(n=t.call(this,e)).users=b.collection("users"),n.userChats=b.collection("userChats"),n.chats=b.collection("chats"),n.chatMessages=b.collection("chatMessages"),n.msgListener=[],n.state={padding:!0,mobile:null,chatListClass:"active",chatSpaceClass:"",headerHeight:null,current:{chat:{},members:[],dialogue:[]},chats:[]},n.IsMobile=n.IsMobile.bind(Object(h.a)(n)),n.WindowResize=n.WindowResize.bind(Object(h.a)(n)),n.showChatList=n.showChatList.bind(Object(h.a)(n)),n.showChatSpace=n.showChatSpace.bind(Object(h.a)(n)),n.UpdateDimensions=n.UpdateDimensions.bind(Object(h.a)(n)),n.HandleChangeChatId=n.HandleChangeChatId.bind(Object(h.a)(n)),n.GetChats=n.GetChats.bind(Object(h.a)(n)),n.SetCurrentChat=n.SetCurrentChat.bind(Object(h.a)(n)),n.GetCurrentUsers=n.GetCurrentUsers.bind(Object(h.a)(n)),n.GetCurrentMessages=n.GetCurrentMessages.bind(Object(h.a)(n)),n.AddMessages=n.AddMessages.bind(Object(h.a)(n)),n.GetMessages=n.GetMessages.bind(Object(h.a)(n)),n}return Object(l.a)(a,[{key:"componentDidMount",value:function(){var e=this;this.IsMobile(),this.GetChats().then((function(t){t?(e.GetMessages(),e.HandleChangeChatId()):e.setState({padding:!1},(function(){e.UpdateDimensions()}))})),window.addEventListener("resize",this.WindowResize)}},{key:"shouldComponentUpdate",value:function(e,t){return!0}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.WindowResize)}},{key:"UpdateDimensions",value:function(){this.setState({headerHeight:this.props.header.current.clientHeight})}},{key:"IsMobile",value:function(){var e=window.matchMedia("(max-width: 700px)");this.setState({mobile:e.matches})}},{key:"WindowResize",value:function(){this.IsMobile()}},{key:"showChatList",value:function(){this.setState({chatListClass:"ready",chatSpaceClass:"active"},(function(){var e=this;setTimeout((function(){e.setState({chatListClass:"ready go",chatSpaceClass:"active go"},(function(){var e=this;setTimeout((function(){e.setState({chatListClass:"active",chatSpaceClass:""})}),600)}))}),50)}))}},{key:"showChatSpace",value:function(){if(!this.state.mobile)return!1;this.setState({chatListClass:"active",chatSpaceClass:"ready"},(function(){var e=this;setTimeout((function(){e.setState({chatListClass:"active go",chatSpaceClass:"ready go"},(function(){var e=this;setTimeout((function(){e.setState({chatListClass:"",chatSpaceClass:"active"})}),600)}))}),50)}))}},{key:"HandleChangeChatId",value:function(e){var t,a=this.context,n=a.currentChatId,r=a.changeChatId;(t=!e&&n?n:e||this.state.chats[0].id)!==n&&r(t),this.setState({current:{chat:{},members:[],dialogue:[]}},Object(A.a)(D.a.mark((function e(){var a=this;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.SetCurrentChat(t);case 2:return e.next=4,this.GetCurrentMessages(t);case 4:this.setState({padding:!1},(function(){a.showChatSpace(),a.UpdateDimensions()}));case 5:case"end":return e.stop()}}),e,this)}))))}},{key:"GetChats",value:function(){var e=this,t=this.context.currentUser,a=this,n=[];return this.chatsListener&&(this.chatsListener(),this.chatsListener=null),new Promise((function(r){e.chatsListener=e.chats.where("members","array-contains",t.uid).onSnapshot(function(){var e=Object(A.a)(D.a.mark((function e(c){var i,s,l;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!((i=c.docChanges()).length>0)){e.next=12;break}s=D.a.mark((function e(r){var c,s,l,o,u,m;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(c=i[r],s=c.doc.id,l=c.doc.data(),o=Object(ne.a)(Object(ne.a)({},l),{},{id:s}),"added"!==c.type){e.next=14;break}if(2!=l.members.length){e.next=12;break}return u=l.members.filter((function(e){return e!==t.uid}))[0],e.next=9,a.users.doc(u).get().then((function(e){return e.data()}));case 9:m=e.sent,o.name=m.nickname,o.avatar=m.avatar.url;case 12:n.push(o),n.length>1&&n.sort((function(e,t){return t.last_msg_id-e.last_msg_id}));case 14:"modified"===c.type&&n.forEach((function(e){e.id===o.id&&(e.unread=o.unread)}));case 15:case"end":return e.stop()}}),e)})),e.t0=D.a.keys(i);case 4:if((e.t1=e.t0()).done){e.next=9;break}return l=e.t1.value,e.delegateYield(s(l),"t2",7);case 7:e.next=4;break;case 9:a.setState({chats:n},(function(){r(!0)})),e.next=13;break;case 12:r(!1);case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}))}},{key:"GetMessages",value:function(){var e=this,t=this,a=Object(ae.a)(this.state.chats);this.msgListener.length>0&&(this.msgListener.forEach((function(e){e()})),this.msgListener.length=0);var n=function(n){var r=a[n].id.toString(),c="",i="",s=e.chatMessages.doc(r).collection("messages");e.msgListener[n]=s.orderBy("created","desc").limit(1).onSnapshot(function(){var e=Object(A.a)(D.a.mark((function e(a){var n,s,l,o,u,m;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(s in n=a.docChanges())l=n[s],o=l.doc.id,u=l.doc.data(),m=Object(ne.a)(Object(ne.a)({},u),{},{id:o}),"added"===l.type&&(c=m.text,i=m.id);t.chats.doc(r).update({last_msg:c,last_msg_id:i}).then((function(){t.setState((function(e){var t=e.chats,a=t.findIndex((function(e){return e.id===r}));return t[a]=Object(ne.a)(Object(ne.a)({},t[a]),{},{last_msg:c,last_msg_id:i}),t.sort((function(e,t){return t.last_msg_id-e.last_msg_id})),{chats:t}}))}));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())};for(var r in a)n(r)}},{key:"SetCurrentChat",value:function(e){var t=this,a=this.state.chats.filter((function(t){return t.id===e}))[0];this.setState((function(e){return{current:Object(ne.a)(Object(ne.a)({},e.current),{},{chat:a})}}),(function(){t.GetCurrentUsers(t.state.current.chat.members)}))}},{key:"GetCurrentMessages",value:function(e){var t=this,a=this.context,n=a.currentUser,r=a.currentChatId,c=this.chatMessages.doc(e.toString()).collection("messages"),i=[];this.currentMsgListener&&(this.currentMsgListener(),this.currentMsgListener=null),this.currentMsgListener=c.orderBy("created","desc").onSnapshot((function(e){var a=e.docChanges(),s=function(e){var s=a[e],l=s.doc.id,o=s.doc.data();if("added"===s.type&&(o.sentBy===n.uid||o.readed||(c.doc(l).update({readed:!0}),t.chats.doc(r).update(Object(te.a)({},"unread."+n.uid,0))),i.push(Object(ne.a)(Object(ne.a)({},o),{},{id:l}))),"modified"===s.type){var u=i.findIndex((function(e){return e.id==l}));i[u]=Object(ne.a)(Object(ne.a)({},o),{},{id:l})}};for(var l in a)s(l);i.sort((function(e,t){return t.id-e.id})),t.setState((function(e){return{current:Object(ne.a)(Object(ne.a)({},e.current),{},{dialogue:i})}}))}))}},{key:"GetCurrentUsers",value:function(){var e=Object(A.a)(D.a.mark((function e(t){var a,n;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=[],e.t0=D.a.keys(t);case 2:if((e.t1=e.t0()).done){e.next=8;break}return n=e.t1.value,e.next=6,this.users.doc(t[n]).get().then((function(e){a.push(Object(ne.a)(Object(ne.a)({},e.data()),{},{id:e.id}))}));case 6:e.next=2;break;case 8:this.setState((function(e){return{current:Object(ne.a)(Object(ne.a)({},e.current),{},{members:a})}}));case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"AddMessages",value:function(e){var t=this.context,a=t.currentUser,n=t.currentChatId,r=Date.now().toString(),c=this.state.current.members.filter((function(e){return e.id!==a.uid}))[0];this.chatMessages.doc(n.toString()).collection("messages").doc(r).set(Object(ne.a)({type:1,text:"",imgs:[],readed:!1,created:v.a.firestore.FieldValue.serverTimestamp()},e)),this.chats.doc(n).update(Object(te.a)({},"unread."+c.id,v.a.firestore.FieldValue.increment(1)))}},{key:"render",value:function(){return this.state.padding?r.a.createElement("div",{className:"pt-5 text-center"},"Loading..."):r.a.createElement("main",{className:"chat"},r.a.createElement("div",{className:"chat-row"},r.a.createElement(ue,{className:this.state.chatListClass,headerHeight:this.state.headerHeight,talking:this.HandleChangeChatId,chats:this.state.chats}),r.a.createElement(fe,{className:this.state.chatSpaceClass,headerHeight:this.state.headerHeight,toList:this.showChatList,current:this.state.current,AddMessages:this.AddMessages})))}}]),a}(r.a.Component);be.contextType=E;var ge=be,Ee=(a(98),a(62)),_e=a.n(Ee),Ce=a(46),ke=a.n(Ce),ye=function(e){Object(o.a)(a,e);var t=Object(u.a)(a);function a(e){var r;return Object(s.a)(this,a),(r=t.call(this,e)).state={imgFileLocal:null,imgUrl:null},r.ChangeFile=r.ChangeFile.bind(Object(h.a)(r)),r.CheckImgSize=r.CheckImgSize.bind(Object(h.a)(r)),r.HandlerImg=r.HandlerImg.bind(Object(h.a)(r)),r.Compression=r.Compression.bind(Object(h.a)(r)),r.SetUserAvatar=r.SetUserAvatar.bind(Object(h.a)(r)),r.DeleteUserAvatar=r.DeleteUserAvatar.bind(Object(h.a)(r)),r._file=Object(n.createRef)(),r._canvas=Object(n.createRef)(),r.users=b.collection("users"),r}return Object(l.a)(a,[{key:"componentDidMount",value:function(){var e=this,t=this.context.currentUser;t&&this.users.doc(t.uid).get().then((function(t){e.setState({imgFileLocal:t.data().avatar.fileLocation,imgUrl:t.data().avatar.url},(function(){this.HandlerImg(this.state.imgUrl)}))}))}},{key:"ChangeFile",value:function(){var e=this,t=new FileReader,a=this._file.current.files[0];"undefined"!==typeof a&&(this.CheckImgSize(a.size)?(t.readAsDataURL(a),t.onload=function(){var n=t.result;n.length>0&&e.HandlerImg(n,a)}):this._file.current.value="")}},{key:"CheckImgSize",value:function(e){var t=Math.ceil(e/1024),a=Math.ceil(10240);return!(e>10485760)||(alert("\u60a8\u6240\u9078\u64c7\u7684\u6a94\u6848\u5927\u5c0f\u70ba ".concat(t,"KB\uff0c\u5df2\u8d85\u904e\u4e0a\u50b3\u4e0a\u9650\u3002(\u6a94\u6848\u4e0a\u9650\uff1a").concat(a,"KB\u3002)")),!1)}},{key:"HandlerImg",value:function(e,t){var a,n,r=this._canvas.current,c=this;if(r.getContext){var i=new Image;i.src=e,i.onload=function(){var e=r.getContext("2d"),s=c.ImgDimensions(i,200),l=s.width,o=s.height;r.width=200,r.height=200,a=(l-r.width)/-2,n=(o-r.height)/-2,e.drawImage(this,a,n,l,o),t&&c.Compression(t)}}}},{key:"ImgDimensions",value:function(e,t){var a,n=e.width,r=e.height,c=Math.min(n,r),i=Math.min(n,r);if(n===r&&n==t)return{width:n,height:r};switch(t>=i?i:c){case n:a=n/r,n=t,r/=a;break;default:n/=a=r/t,r=t}return{width:n,height:r}}},{key:"Compression",value:function(e){var t=this;this._canvas.current.toBlob((function(a){var n="avatars/"+e.name.replace(/(.+)(\.(jpg|jpeg|png))$/gi,Date.now()+"$2");g.ref(n).put(a).then((function(e){t.SetUserAvatar(n)}))}),e.type,.9)}},{key:"SetUserAvatar",value:function(){var e=Object(A.a)(D.a.mark((function e(t){var a,n=this;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=this.context.currentUser,!this.state.imgFileLocal||"avatars/default.jpg"===this.state.imgFileLocal){e.next=4;break}return e.next=4,this.DeleteUserAvatar();case 4:g.ref(t).getDownloadURL().then((function(e){n.users.doc(a.uid).update({avatar:{fileLocation:t,url:e}}).then((function(){n.setState({imgFileLocal:t,imgUrl:e})}))}));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"DeleteUserAvatar",value:function(){g.ref(this.state.imgFileLocal).delete()}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:ke.a.avatar},r.a.createElement("div",{className:ke.a["img-frame"]},r.a.createElement("canvas",{ref:this._canvas})),r.a.createElement("div",{className:"d-none"},r.a.createElement("input",{ref:this._file,type:"file",name:"avatar",id:"avatar",accept:"image/png, image/jpeg",onChange:this.ChangeFile})),r.a.createElement("button",{className:ke.a["avatar-btn"],onClick:function(){return e._file.current.click()}},"\u7de8\u8f2f"))}}]),a}(r.a.Component);ye.contextType=E;var je=ye,Oe=function(e){return e.isEdit?r.a.createElement("div",{className:"col-12 nickname"},r.a.createElement(R.c,{initialValues:{nickname:""},onSubmit:function(t,a){var n=a.resetForm,r=f.currentUser;b.collection("users").doc(r.uid).update({nickname:t.nickname}).then((function(){e.getUserInfo(),n({nickname:""}),e.onClick()}))}},r.a.createElement(R.b,{className:_e.a["input-field"]},r.a.createElement(K,{label:"\u66b1\u7a31/\u7a31\u547c",name:"nickname",type:"text",validate:G}),r.a.createElement("button",{type:"submit",className:"btn"},"\u78ba\u8a8d")))):r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"col-3"},r.a.createElement("p",{className:"label"},"\u7a31\u547c")),r.a.createElement("div",{className:"col-9 nickname"},r.a.createElement("p",{className:"value pr-4"},e.nickname?e.nickname:"nobody"),r.a.createElement("button",{className:"btn btn-sm",onClick:e.onClick},"\u7de8\u8f2f")))},Ne=function(e){Object(o.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(s.a)(this,a),(n=t.call(this,e)).state={email:null,nickname:null,isEdit:!1},n.getUserInfo=n.getUserInfo.bind(Object(h.a)(n)),n.handlerClick=n.handlerClick.bind(Object(h.a)(n)),n}return Object(l.a)(a,[{key:"getUserInfo",value:function(){var e=this.context.currentUser,t=this;b.collection("users").doc(e.uid).get().then((function(a){var n=a.data();t.setState({email:e.email,nickname:n.nickname})}))}},{key:"handlerClick",value:function(){this.setState((function(e){return{isEdit:!e.isEdit}}))}},{key:"componentDidMount",value:function(){this.getUserInfo()}},{key:"render",value:function(){return r.a.createElement("main",{className:"account bg-secondary"},r.a.createElement("div",{className:"container"},r.a.createElement("h1",{className:"text-center"},"\u6703\u54e1\u8cc7\u6599"),r.a.createElement("div",{className:"account-content"},r.a.createElement(je,null),r.a.createElement("div",{className:"row"},r.a.createElement(Oe,{nickname:this.state.nickname,getUserInfo:this.getUserInfo,isEdit:this.state.isEdit,onClick:this.handlerClick})),r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-3"},r.a.createElement("p",{className:"label"},"Email")),r.a.createElement("div",{className:"col-9"},r.a.createElement("p",{className:"value"},this.state.email))))))}}]),a}(r.a.Component);Ne.contextType=E;var we=Ne,xe=(a(99),a(35)),Se=a.n(xe),Ue=function(e){var t=e.person;return r.a.createElement("div",{className:Se.a.card},r.a.createElement("div",{className:Se.a["img-frame"]},r.a.createElement("img",{src:t.avatar,alt:t.name})),r.a.createElement("div",{className:Se.a["card-body"]},r.a.createElement("h3",{className:Se.a["card-title"]},t.nickname),r.a.createElement("button",{className:Se.a.btn,onClick:function(){return e.onClick(e.id)}},"\u804a\u5929")))},Me=function(e){Object(o.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(s.a)(this,a),(n=t.call(this,e)).users=b.collection("users"),n.userChats=b.collection("userChats"),n.state={members:[]},n.createChat=n.createChat.bind(Object(h.a)(n)),n.getMembers=n.getMembers.bind(Object(h.a)(n)),n}return Object(l.a)(a,[{key:"componentDidMount",value:function(){this.users.get().then(this.getMembers)}},{key:"componentWillUnmount",value:function(){}},{key:"getMembers",value:function(e){var t=this.context.currentUser,a=[];e.forEach((function(e){var n=e.data();if(t&&t.uid===e.id)return!1;a.push({id:e.id,nickname:n.nickname,avatar:n.avatar.url})})),this.setState({members:a})}},{key:"createChat",value:function(){var e=Object(A.a)(D.a.mark((function e(t){var a,n,r,c,i,s,l,o,u=this;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=this.context,n=a.currentUser,r=a.changeChatId,c=b.collection("userChats"),!n){e.next=13;break}return i=b.collection("chats"),e.next=6,c.doc(n.uid).get().then((function(e){return!!e.exists&&Object.keys(e.data()).includes(t)}));case 6:return s=e.sent,e.next=9,c.doc(n.uid).get().then((function(e){return!!e.exists&&Object.keys(e.data()).includes(n.uid)}));case 9:l=e.sent,s||l?this.userChats.doc(n.uid).get().then((function(e){e.exists&&(r(e.data()[t]),u.props.history.push("/chat"))})):i.add({name:null,avatar:null,members:[n.uid,t],last_msg_id:null,unread:(o={},Object(te.a)(o,n.uid,0),Object(te.a)(o,t,0),o)}).then((function(e){var a=e.id;c.doc(n.uid).set(Object(te.a)({},t,a),{merge:!0}),c.doc(t).set(Object(te.a)({},n.uid,a),{merge:!0}),r(a),u.props.history.push("/chat")})),e.next=14;break;case 13:this.props.history.push("/login");case 14:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this,t=this.state.members.map((function(t){return r.a.createElement("div",{key:t.id,className:"col-6 col-md-4 col-lg-3"},r.a.createElement(Ue,{id:t.id,person:t,onClick:e.createChat}))}));return r.a.createElement("main",{className:"members bg-secondary"},r.a.createElement("div",{className:"container"},r.a.createElement("div",{className:"row"},t)))}}]),a}(r.a.Component);Me.contextType=E;var Le=Me,He=function(e){Object(o.a)(a,e);var t=Object(u.a)(a);function a(e){var r;return Object(s.a)(this,a),(r=t.call(this,e))._header=Object(n.createRef)(),r}return Object(l.a)(a,[{key:"render",value:function(){return r.a.createElement(_,null,r.a.createElement(m.a,null,r.a.createElement(r.a.Fragment,null,r.a.createElement(L,{headerRef:this._header}),r.a.createElement(d.d,null,r.a.createElement(d.b,{exact:!0,path:"/",component:Le}),r.a.createElement(d.b,{exact:!0,path:"/login",component:ee}),r.a.createElement(k,{exact:!0,path:"/chat/",props:{header:this._header},component:ge}),r.a.createElement(k,{exact:!0,path:"/account",component:we})))))}}]),a}(r.a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));a(100);i.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(He,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}],[[64,1,2]]]);
//# sourceMappingURL=main.e08add6c.chunk.js.map